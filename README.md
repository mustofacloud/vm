### Generated by BLACKBOX.AI
https://www.blackbox.ai
### YOU
buatkan website pembelian show theater JKT48 menggunakan vite js. fitur website ini menggunakan sistem pembayaran midtrans.

1. UI website menggunakan tailwindcss, support desktop dan mobile.
2. backend dan login sistem berjalan sekaligus dengan file yang menjalankan bot discord agar lebih ringkas 
3. dashboard admin untuk CRUD show seperti nama show, tanggal, harga, thumbnail, role discord sesuai show.
4. Halaman pembelian dengan tema dark UI marketplace.
5. database MongoDB.
6. sistem pembelian bertahap. Login discord (user) - beli show - simpan transaksi pembelian beserta user id discord - konfirmasi pembelian - bot menambah role sesuai show.
### BLACKBOX.AI

<think>
Pertama, tugasnya adalah membuat website pembelian show theater JKT48 menggunakan Vite.js. Fitur utama:


## Outlining website features  
- The task is to build a website for JKT48 theater show ticket purchases using Vite.js.  
- Key features include a responsive UI designed with TailwindCSS, supporting both desktop and mobile users.  

## Planning technical implementation  
- The website needs a backend system integrated with a login feature.  
- Both backend and login functionalities should operate seamlessly together.
</think>Berikut adalah panduan lengkap untuk membuat website pembelian show theater JKT48 menggunakan Vite.js, dengan fitur-fitur yang Anda minta. Saya akan menyusunnya secara bertahap, termasuk struktur proyek, kode utama, dan penjelasan. Proyek ini akan menggunakan:

- **Frontend**: Vite.js dengan React (untuk kemudahan UI), TailwindCSS untuk styling (dark theme marketplace), dan responsif untuk desktop/mobile.
- **Backend**: Node.js dengan Express.js, MongoDB (via Mongoose), dan integrasi Midtrans untuk pembayaran.
- **Authentication**: Login via Discord OAuth.
- **Bot Discord**: Menggunakan discord.js, dijalankan bersamaan dengan backend untuk menambah role setelah konfirmasi pembayaran.
- **Database**: MongoDB untuk menyimpan shows, users, dan transactions.

### Prasyarat
- Node.js (versi 16+), npm/yarn.
- Akun MongoDB Atlas atau lokal.
- Akun Midtrans (untuk sandbox/production).
- Aplikasi Discord Bot (dapatkan token dari Discord Developer Portal) dan OAuth2 setup.
- Server ID Discord untuk guild (server) JKT48.

### Struktur Proyek
Buat folder utama, misalnya `jkt48-show-theater`:

```
jkt48-show-theater/
├── frontend/          # Vite.js app (React)
│   ├── src/
│   │   ├── components/  # Komponen UI (Navbar, ShowCard, dll.)
│   │   ├── pages/       # Halaman (Home, Purchase, AdminDashboard)
│   │   ├── utils/       # Helper (auth, api)
│   │   ├── App.jsx
│   │   ├── main.jsx
│   │   └── index.css    # TailwindCSS
│   ├── public/
│   ├── package.json
│   └── vite.config.js
├── backend/           # Express server + Discord bot
│   ├── models/         # Mongoose models (Show, User, Transaction)
│   ├── routes/         # API routes (auth, shows, payments)
│   ├── middleware/     # Auth middleware
│   ├── config/         # DB, Midtrans, Discord config
│   ├── bot.js          # Discord bot logic
│   ├── server.js       # Main server
│   ├── package.json
│   └── .env            # Environment variables
└── README.md
```

### 1. Setup Backend (Express + MongoDB + Discord Bot)
Pertama, setup backend. Jalankan `npm init -y` di folder `backend`.

**package.json** (backend):
```json
{
  "name": "jkt48-backend",
  "version": "1.0.0",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^7.5.0",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "discord.js": "^14.13.0",
    "passport": "^0.6.0",
    "passport-discord": "^0.1.4",
    "midtrans-client": "^1.3.1",
    "express-session": "^1.17.3",
    "bcryptjs": "^2.4.3"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}
```

**server.js** (Main server, menjalankan Express dan bot Discord sekaligus):
```javascript
require('dotenv').config();
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const session = require('express-session');
const passport = require('passport');
const { Client, GatewayIntentBits } = require('discord.js');
const bot = require('./bot'); // Import bot logic

const app = express();
const PORT = process.env.PORT || 5000;

// Connect to MongoDB
mongoose.connect(process.env.MONGO_URI, { useNewUrlParser: true, useUnifiedTopology: true })
  .then(() => console.log('MongoDB connected'))
  .catch(err => console.error(err));

// Middleware
app.use(cors({ origin: 'http://localhost:3000', credentials: true })); // Frontend URL
app.use(express.json());
app.use(session({ secret: process.env.SESSION_SECRET, resave: false, saveUninitialized: false }));
app.use(passport.initialize());
app.use(passport.session());

// Passport Discord Strategy
require('./config/passport')(passport);

// Routes
app.use('/api/auth', require('./routes/auth'));
app.use('/api/shows', require('./routes/shows'));
app.use('/api/payments', require('./routes/payments'));

// Start server
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
  bot.start(); // Start Discord bot
});
```

**bot.js** (Discord bot logic):
```javascript
const { Client, GatewayIntentBits } = require('discord.js');
const client = new Client({ intents: [GatewayIntentBits.Guilds, GatewayIntentBits.GuildMembers] });

client.once('ready', () => {
  console.log('Discord bot is ready!');
});

client.login(process.env.DISCORD_TOKEN);

// Function to assign role after payment confirmation
async function assignRole(userId, roleId, guildId) {
  try {
    const guild = await client.guilds.fetch(guildId);
    const member = await guild.members.fetch(userId);
    await member.roles.add(roleId);
    console.log(`Role ${roleId} assigned to ${userId}`);
  } catch (error) {
    console.error('Error assigning role:', error);
  }
}

module.exports = { start: () => client.login(process.env.DISCORD_TOKEN), assignRole };
```

**config/passport.js** (Discord OAuth):
```javascript
const DiscordStrategy = require('passport-discord').Strategy;
const User = require('../models/User');

module.exports = (passport) => {
  passport.use(new DiscordStrategy({
    clientID: process.env.DISCORD_CLIENT_ID,
    clientSecret: process.env.DISCORD_CLIENT_SECRET,
    callbackURL: 'http://localhost:5000/api/auth/discord/callback',
    scope: ['identify', 'guilds']
  }, async (accessToken, refreshToken, profile, done) => {
    try {
      let user = await User.findOne({ discordId: profile.id });
      if (!user) {
        user = new User({ discordId: profile.id, username: profile.username });
        await user.save();
      }
      return done(null, user);
    } catch (err) {
      return done(err, null);
    }
  }));

  passport.serializeUser((user, done) => done(null, user.id));
  passport.deserializeUser(async (id, done) => {
    const user = await User.findById(id);
    done(null, user);
  });
};
```

**models/Show.js**:
```javascript
const mongoose = require('mongoose');
const showSchema = new mongoose.Schema({
  name: String,
  date: Date,
  price: Number,
  thumbnail: String, // URL gambar
  discordRoleId: String // Role ID Discord
});
module.exports = mongoose.model('Show', showSchema);
```

**models/User.js**:
```javascript
const mongoose = require('mongoose');
const userSchema = new mongoose.Schema({
  discordId: String,
  username: String
});
module.exports = mongoose.model('User', userSchema);
```

**models/Transaction.js**:
```javascript
const mongoose = require('mongoose');
const transactionSchema = new mongoose.Schema({
  userId: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  showId: { type: mongoose.Schema.Types.ObjectId, ref: 'Show' },
  status: { type: String, enum: ['pending', 'paid', 'failed'], default: 'pending' },
  midtransOrderId: String
});
module.exports = mongoose.model('Transaction', transactionSchema);
```

**routes/auth.js** (Login Discord):
```javascript
const express = require('express');
const passport = require('passport');
const router = express.Router();

router.get('/discord', passport.authenticate('discord'));
router.get('/discord/callback', passport.authenticate('discord', { failureRedirect: '/' }), (req, res) => {
  res.redirect('http://localhost:3000'); // Redirect to frontend
});
router.get('/logout', (req, res) => {
  req.logout();
  res.redirect('/');
});
router.get('/user', (req, res) => {
  if (req.user) res.json(req.user);
  else res.status(401).json({ message: 'Not authenticated' });
});

module.exports = router;
```

**routes/shows.js** (CRUD untuk admin):
```javascript
const express = require('express');
const Show = require('../models/Show');
const router = express.Router();

// Middleware untuk admin (sederhana, tambahkan auth proper)
const isAdmin = (req, res, next) => { /* Implementasi auth admin */ next(); };

// GET all shows
router.get('/', async (req, res) => {
  const shows = await Show.find();
  res.json(shows);
});

// POST create show (admin)
router.post('/', isAdmin, async (req, res) => {
  const show = new Show(req.body);
  await show.save();
  res.json(show);
});

// PUT update show
router.put('/:id', isAdmin, async (req, res) => {
  const show = await Show.findByIdAndUpdate(req.params.id, req.body, { new: true });
  res.json(show);
});

// DELETE show
router.delete('/:id', isAdmin, async (req, res) => {
  await Show.findByIdAndDelete(req.params.id);
  res.json({ message: 'Deleted' });
});

module.exports = router;
```

**routes/payments.js** (Integrasi Midtrans):
```javascript
const express = require('express');
const midtransClient = require('midtrans-client');
const Transaction = require('../models/Transaction');
const { assignRole } = require('../bot');
const router = express.Router();

const snap = new midtransClient.Snap({
  isProduction: false, // Set true untuk production
  serverKey: process.env.MIDTRANS_SERVER_KEY,
  clientKey: process.env.MIDTRANS_CLIENT_KEY
});

// POST create payment
router.post('/create', async (req, res) => {
  const { showId } = req.body;
  const user = req.user; // From auth middleware
  const show = await Show.findById(showId);

  const transaction = new Transaction({ userId: user._id, showId });
  await transaction.save();

  const parameter = {
    transaction_details: {
      order_id: transaction._id.toString(),
      gross_amount: show.price
    },
    customer_details: {
      first_name: user.username
    }
  };

  const snapToken = await snap.createTransaction(parameter);
  res.json({ snapToken, transactionId: transaction._id });
});

// POST handle Midtrans notification (webhook)
router.post('/notification', async (req, res) => {
  const notification = req.body;
  const transaction = await Transaction.findById(notification.order_id);
  if (notification.transaction_status === 'settlement') {
    transaction.status = 'paid';
    await transaction.save();
    // Assign role
    const show = await Show.findById(transaction.showId);
    assignRole(transaction.userId.discordId, show.discordRoleId, process.env.DISCORD_GUILD_ID);
  }
  res.status(200).send('OK');
});

module.exports = router;
```

**.env** (backend):
```
MONGO_URI=mongodb://localhost:27017/jkt48
SESSION_SECRET=your_secret
DISCORD_CLIENT_ID=your_client_id
DISCORD_CLIENT_SECRET=your_client_secret
DISCORD_TOKEN=your_bot_token
DISCORD_GUILD_ID=your_guild_id
MIDTRANS_SERVER_KEY=your_server_key
MIDTRANS_CLIENT_KEY=your_client_key
```

### 2. Setup Frontend (Vite.js + React + TailwindCSS)
Jalankan `npm create vite@latest frontend -- --template react` di folder utama, lalu `cd frontend` dan `npm install`.

**package.json** (frontend):
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "axios": "^1.5.0",
    "react-router-dom": "^6.15.0"
  },
  "devDependencies": {
    "tailwindcss": "^3.3.3",
    "autoprefixer": "^10.4.15",
    "postcss": "^8.4.29"
  }
}
```

**tailwind.config.js**:
```javascript
module.exports = {
  content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],
  darkMode: 'class', // Enable dark mode
  theme: { extend: {} },
  plugins: [],
};
```

**index.css**:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;
body { @apply bg-gray-900 text-white; } /* Dark theme default */
```

**App.jsx** (Routing):
```jsx
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import Home from './pages/Home';
import Purchase from './pages/Purchase';
import AdminDashboard from './pages/AdminDashboard';
import Navbar from './components/Navbar';

function App() {
  return (
    <Router>
      <div className="min-h-screen bg-gray-900 text-white">
        <Navbar />
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/purchase/:id" element={<Purchase />} />
          <Route path="/admin" element={<AdminDashboard />} />
        </Routes>
      </div>
    </Router>
  );
}

export default App;
```

**components/Navbar.jsx** (Responsive navbar):
```jsx
import { useState } from 'react';
import axios from 'axios';

function Navbar() {
  const [user, setUser] = useState(null);

  const login = () => window.location.href = 'http://localhost:5000/api/auth/discord';
  const logout = () => axios.get('/api/auth/logout').then(() => setUser(null));

  // Fetch user on mount
  useState(() => {
    axios.get('/api/auth/user').then(res => setUser(res.data)).catch(() => {});
  }, []);

  return (
    <nav className="bg-gray-800 p-4 flex justify-between items-center">
      <h1 className="text-xl font-bold">JKT48 Show Theater</h1>
      <div className="md:hidden"> {/* Mobile menu toggle */} </div>
      <div className="hidden md:flex space-x-4">
        {user ? <button onClick={logout}>Logout</button> : <button onClick={login}>Login Discord</button>}
      </div>
    </nav>
  );
}

export default Navbar;
```

**pages/Home.jsx** (Marketplace halaman utama):
```jsx
import { useEffect, useState } from 'react';
import axios from 'axios';
import { Link } from 'react-router-dom';

function Home() {
  const [shows, setShows] = useState([]);

  useEffect(() => {
    axios.get('/api/shows').then(res => setShows(res.data));
  }, []);

  return (
    <div className="container mx-auto p-4">
      <h2 className="text-2xl mb-4">Available Shows</h2>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {shows.map(show => (
          <div key={show._id} className="bg-gray-800 p-4 rounded">
            <img src={show.thumbnail} alt={show.name} className="w-full h-48 object-cover" />
            <h3>{show.name}</h3>
            <p>{new Date(show.date).toLocaleDateString()}</p>
            <p>Rp {show.price}</p>
            <Link to={`/purchase/${show._id}`} className="bg-blue-600 px-4 py-2 rounded">Buy Now</Link>
          </div>
        ))}
      </div>
    </div>
  );
}

export default Home;
```

**pages/Purchase.jsx** (Halaman pembelian dengan Midtrans):
```jsx
import { useEffect, useState } from 'react';
import { useParams } from 'react-router-dom';
import axios from 'axios';

function Purchase() {
  const { id } = useParams();
  const [snapToken, setSnapToken] = useState(null);

  useEffect(() => {
    axios.post('/api/payments/create', { showId: id }, { withCredentials: true })
      .then(res => setSnapToken(res.data.snapToken));
  }, [id]);

  useEffect(() => {
    if (snapToken) {
      window.snap.pay(snapToken); // Midtrans Snap popup
    }
  }, [snapToken]);

  return (
    <div className="container mx-auto p-4">
      <h2 className="text-2xl">Purchase Show</h2>
      <p>Processing payment...</p>
    </div>
  );
}

export default Purchase;
```

**pages/AdminDashboard.jsx** (CRUD untuk admin):
```jsx
// Implementasi sederhana CRUD dengan form untuk add/edit shows
// Gunakan state untuk list shows, dan axios untuk API calls
function AdminDashboard() {
  // Kode CRUD di sini (mirip dengan routes/shows.js)
  return <div>Admin CRUD Interface</div>;
}

export default AdminDashboard;
```

### 3. Menjalankan Proyek
- **Backend**: `cd backend && npm install && npm run dev`
- **Frontend**: `cd frontend && npm install && npm run dev`
- Akses frontend di `http://localhost:3000`, backend di `http://localhost:5000`.
- Pastikan webhook Midtrans diarahkan ke `/api/payments/notification`.

### Catatan Tambahan
- **Security**: Tambahkan middleware auth proper untuk admin dan user.
- **Error Handling**: Tambahkan try-catch di semua API.
- **Deployment**: Gunakan Vercel/Netlify untuk frontend, Heroku/Railway untuk backend.
- Jika ada error atau perlu penyesuaian, beri tahu detailnya! Proyek ini ringkas tapi lengkap untuk memulai.
